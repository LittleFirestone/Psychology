<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Healing Journey Diary</title>

<!-- jsPDF for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        color: #333;
        background: linear-gradient(270deg, #ffd6e0, #e0f7fa, #e1bee7, #fff9c4);
        background-size: 800% 800%;
        animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .container {
        max-width: 900px;
        margin: auto;
        padding: 20px;
    }

    h1 {
        text-align: center;
        font-size: 2rem;
        margin-bottom: 10px;
    }

    .entry-box {
        background: rgba(255,255,255,0.9);
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        margin-bottom: 20px;
    }

    input, textarea, button, select {
        width: 100%;
        padding: 10px;
        margin: 6px 0;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 1rem;
    }

    button {
        background-color: #a7c7e7;
        border: none;
        cursor: pointer;
    }

    button:hover {
        background-color: #90b4d5;
    }

    .entry {
        background: rgba(255,255,255,0.95);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .topic {
        font-weight: bold;
        color: #6a1b9a;
    }
</style>
</head>
<body>
<div class="container">
    <h1>Healing Journey Diary</h1>

    <div class="entry-box">
        <input type="text" id="topic" placeholder="Topic (e.g. Trauma, Therapy)">
        <textarea id="content" rows="4" placeholder="Write your thoughts here..."></textarea>
        <button onclick="addEntry()">Add Entry</button>
        <button onclick="exportPDF()">Export as PDF</button>
    </div>

    <div class="entry-box">
        <input type="text" id="search" placeholder="Search by topic..." oninput="searchEntries()">
    </div>

    <div id="entries"></div>
</div>

<script>
    let entries = JSON.parse(localStorage.getItem("diaryEntries")) || [];

    function addEntry() {
        const topic = document.getElementById("topic").value.trim();
        const content = document.getElementById("content").value.trim();
        if (!topic || !content) return alert("Please fill in both fields");

        const newEntry = {
            topic,
            content,
            date: new Date().toLocaleString()
        };

        entries.unshift(newEntry);
        localStorage.setItem("diaryEntries", JSON.stringify(entries));
        renderEntries();
        document.getElementById("topic").value = "";
        document.getElementById("content").value = "";
    }

    function renderEntries(filter = "") {
        const container = document.getElementById("entries");
        container.innerHTML = "";
        entries
            .filter(e => e.topic.toLowerCase().includes(filter.toLowerCase()))
            .forEach(e => {
                const div = document.createElement("div");
                div.className = "entry";
                div.innerHTML = `<div class="topic">${e.topic}</div>
                                 <div><em>${e.date}</em></div>
                                 <p>${e.content}</p>`;
                container.appendChild(div);
            });
    }

    function searchEntries() {
        const filter = document.getElementById("search").value;
        renderEntries(filter);
    }

    async function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let y = 10;
        doc.setFontSize(16);
        doc.text("Healing Journey Diary", 10, y);
        y += 10;

        entries.forEach(e => {
            doc.setFontSize(12);
            doc.text(`Topic: ${e.topic}`, 10, y);
            y += 6;
            doc.setFontSize(10);
            let splitText = doc.splitTextToSize(`${e.date} - ${e.content}`, 180);
            doc.text(splitText, 10, y);
            y += splitText.length * 5 + 5;
        });

        doc.save("Healing_Journey_Diary.pdf");
    }

    // Placeholder for GPT summary integration
    async function summariseEntries() {
        alert("GPT-5 summary integration placeholder â€“ will connect to OpenAI API later.");
    }

    renderEntries();
</script>
</body>
</html>
